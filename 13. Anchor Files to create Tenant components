#########################################
devraj@DESKTOP-VSU0S4V:~/aci/vars$ cat aci_objects.yml
---
new_tenant: "Tenant1"
state: "present"
new_epg: "EPG_xyx"
new_ap: "AP_xyz"
new_vrf: "VRF_xyz"
new_bd: "BD_xyz"
filter_name: "Web_Filter"
entry_name: "HTTP_Entry"
validate_certs: "false"

#######################################

devraj@DESKTOP-VSU0S4V:~/aci/vars$ cat host_vars.yml
---
ansible_hostname: "192.168.84.10"
ansible_username: "admin"
ansible_password: "cisco123"
######################################

---
- name: using anchors playbook
  hosts: localhost
  connection: local
  
  vars:
    aci_common_vars: &aci_vars #this is being used for anchor
        host: "{{ ansible_hostname }}"
        username: "{{ ansible_username }}"
        password: "{{ ansible_password }}"
        tenant: "{{ new_tenant }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
  vars_files:
    - ./vars/aci_objects.yml
    - ./vars/host_vars.yml
  
  vars_prompt:
  - name: "host"
    prompt: "Enter the IP address of the APIC"
    default: "192.168.84.10"
    private: no

  - name: "username"
    prompt: "Enter the APIC username"
    default: "admin"
    private: no

  - name: "password"
    prompt: "Enter the APIC password"
    private: yes

  tasks:
    - name: Create a new tenant
      cisco.aci.aci_tenant:
        <<: *aci_vars
        description: "{{ new_tenant }} is created using ansible"

    - name: Create a new vrf
      cisco.aci.aci_vrf:
        <<: *aci_vars
        vrf: "{{ new_vrf }}"
        description: "{{ new_vrf }} is created using ansible"

    - name: Create a new ap
      cisco.aci.aci_ap:
        <<: *aci_vars
        ap: "{{ new_ap }}"
        description: "{{ new_ap }} is created using ansible"

    - name: Create a new epg
      cisco.aci.aci_epg:
        <<: *aci_vars
        ap: "{{ new_ap }}"
        epg: "{{ new_epg }}"
        description: "{{ new_epg }} is created using ansible"

    - name: Create a new bd
      cisco.aci.aci_bd:
        <<: *aci_vars
        bd: "{{ new_bd }}"
        vrf: "{{ new_vrf }}"
        description: "{{ new_bd }} is created using ansible"

    - name: Add a new physical domain to EPG binding
      cisco.aci.aci_epg_to_domain:
        <<: *aci_vars
        ap: "{{ new_ap }}"
        epg: "{{ new_epg }}"
        domain: phys_dom
        domain_type: phys
